jobs:
- job: Test
  pool:
    vmImage: 'ubuntu-16.04'
  steps:
  - task: NodeTool@0 
    inputs:
      versionSpec: '10.x'
  - script: |
      npm install
      npx tslint --project .
      npm test

- job: Publish
  pool:
    vmImage: 'ubuntu-16.04'
  dependsOn: Test
  condition: and(succeeded(), eq(variables['Build.SourceBranch'], 'refs/tags/*'))
  steps:
  - task: NodeTool@0
    env:
      SYSTEM_ACCESSTOKEN: $(System.AccessToken)
    inputs:
      versionSpec: '10.x'
  - script: |
      echo "//registry.npmjs.org/:_authToken=$SYSTEM_ACCESSTOKEN" > ~/.npmrc
      npm install
      npm publish

